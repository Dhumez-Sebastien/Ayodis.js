/**
 * @license
 * ayodis.js - v0.0.4
 * Copyright (c) 2014-2015, Dhumez SÃ©bastien
 * https://plus.google.com/117777107050959596079
 *
 * Compiled: 2014-06-01
 *
 * ayodis.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */
var Ayodis=function(){function a(){}return a.__addKeyIfNotExist=function(a,b){return _.isUndefined(this._key[b])?(this._key[b]=new a(b),!0):!1},a.__checkArgs=function(){for(var a=arguments,b=0,c=a.length;c>b;b++)if(_.isUndefined(a[b]))return!1;return!0},a.__checkCallback=function(a){return a&&_.isFunction(a)?a:null},a.__checkHash=function(a){return _.isString(a)},a.__checkField=function(a){return _.isString(a)},a.__checkKey=function(a,b){return _.isUndefined(this._key[a])||this._key[a].getType()===b?"OK":"WRONGTYPE Operation against a key holding the wrong kind of value"},a.__checkValue=function(a){return _.isString(a)||_.isNumber(a)},a.__sendCallback=function(a,b,c){return!_.isUndefined(c)&&_.isFunction(c)&&c(a,b),a&&console.error(a),b},a.exists=function(a){return this._key[a]?void 0:0},a.__msg={ERR_ARGS:"ERR wrong number of arguments for",EMPTY_SET_OR_LIST:"empty list or set",FIELD_MUST_BE_STRING:"Field must be a String",KEY_MUST_BE_STRING:"Key must be a String",VALUE_MUST_BE_STRING_OR_NUMBER:"Value must be a String or Number",OK:"OK"},a.__CONST={KEY:{HASH:"hash",SET:"set"}},a._key={},a}(),AyodisMainEntry=function(){function a(a,b){this._keyName=a,this._type=b}return a.prototype.getType=function(){return this._type},a}(),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},AyodisEntryField=function(a){function b(b){a.call(this,b,Ayodis.__CONST.KEY.HASH),this._field={}}return __extends(b,a),b.prototype.countField=function(){return _.size(this._field)},b.prototype.getAllField=function(){var a=[];for(var b in this._field)a.push(b);return a},b.prototype.getAllFieldAndValue=function(){var a=[];for(var b in this._field)a.push(b),a.push(this._field[b]);return a},b.prototype.getAllFieldValue=function(){var a=[];for(var b in this._field)a.push(this._field[b]);return a},b.prototype.getField=function(a){return this._field[a]},b.prototype.removeField=function(a){return _.isUndefined(this._field[a])?!1:(delete this._field[a],!0)},b.prototype.setField=function(a,b){return this._field[a]=b,this._field[a]},b}(AyodisMainEntry),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},AyodisEntryMember=function(a){function b(b){a.call(this,b,Ayodis.__CONST.KEY.SET),this._member=[]}return __extends(b,a),b.prototype.addIfValueNotExist=function(a){return-1===_.indexOf(this._member,a)?(this._member.push(a),!0):!1},b.prototype.getAllMembers=function(){for(var a=[],b=0,c=this._member.length;c>b;b++)a.push(this._member[b]);return a},b.prototype.removeValue=function(a){var b=_.indexOf(this._member,a);return-1===b?!1:(this._member.splice(b,1),!0)},b}(AyodisMainEntry);Ayodis.hdel=function(a){for(var b=0,c=arguments,d=this.__checkCallback(c[c.length-1]),e=_.isNull(d)?c.length:c.length-1,f=1;e>f;f++)if(!this.__checkField(c[f]))return this.__sendCallback(this.__msg.ERR_ARGS+" HDEL :: "+a,null,d);for(var f=1;e>f;f++)b+=this._key[a]&&this._key[a].removeField(c[f])?1:0;return this.__sendCallback(null,b,d)},Ayodis.hexists=function(a,b,c){return this.__sendCallback(null,this._key[a]&&this._key[a].getField(b)?1:0,c)},Ayodis.hget=function(a,b,c){return this.__sendCallback(null,this._key[a]&&this._key[a].getField(b)?this._key[a].getField(b):null,c)},Ayodis.hgetall=function(a,b){return this.__sendCallback(null,this._key[a]?this._key[a].getAllFieldAndValue():[],b)},Ayodis.hincrby=function(a,b,c,d){if(!_.isNumber(c)||!_.isInteger(c))return this.__sendCallback("ERR value is not an integer or out of range :: Key : "+a+" :: Field : "+b,null,d);this.__addKeyIfNotExist(AyodisEntryField,a);var e,f=this._key[a].getField(b);if(_.isUndefined(f))e=this._key[a].setField(b,c);else{if(!_.isNumber(f)||!_.isInteger(c))return this.__sendCallback("ERR hash value is not an integer",null,d);e=this._key[a].setField(b,f+c)}return this.__sendCallback(null,e,d)},Ayodis.hincrbyfloat=function(a,b,c,d){if(!_.isNumber(c))return this.__sendCallback("ERR value is not an integer or out of range :: Key : "+a+" :: Field : "+b,null,d);var e;this.__addKeyIfNotExist(AyodisEntryField,a);var f=this._key[a].getField(b);if(_.isUndefined(f))e=this._key[a].setField(b,c);else{if(!_.isNumber(f))return this.__sendCallback("ERR hash value is not an integer",null,d);e=this._key[a].setField(b,f+c)}return this.__sendCallback(null,e.toString(),d)},Ayodis.hkeys=function(a,b){return this.__sendCallback(null,this._key[a]?this._key[a].getAllField():[],b)},Ayodis.hlen=function(a,b){return this.__sendCallback(null,this._key[a]?this._key[a].countField():0,b)},Ayodis.hmget=function(a){for(var b=arguments,c=[],d=this.__checkCallback(b[b.length-1]),e=_.isFunction(d)?b.length-1:b.length,f=1;e>f;f++)c.push(this._key[a]&&!_.isUndefined(this._key[a].getField(b[f]))?this._key[a].getField(b[f]):null);return this.__sendCallback(null,c,d)},Ayodis.hmset=function(a){for(var b=arguments,c=this.__checkCallback(b[b.length-1]),d=_.isNull(c)?b.length:b.length-1,e=1,f=d,g=!0;f>e;e++)if(g&&this.__checkField(b[e]))g=!1;else{if(g&&!this.__checkField(b[e]))return this.__sendCallback(this.__msg.ERR_ARGS+" HMSET :: "+a,null,c);if(!g){if(g&&!this.__checkValue(b[e]))return this.__sendCallback(this.__msg.VALUE_MUST_BE_STRING_OR_NUMBER+" :: Hash : "+a+" :: Field : "+g,null,c);g=!0}}if(!g)return this.__sendCallback(this.__msg.ERR_ARGS+" HMSET :: "+a,null,c);for(var h,e=1,f=d,g=!0;f>e;e++)g?(h=b[e],g=!1):(this.__addKeyIfNotExist(AyodisEntryField,a),g||(this._key[a].setField(h,b[e]),g=!0));return this.__sendCallback(null,"OK",c)},Ayodis.hset=function(a,b,c,d){if(!this.__checkValue(c))return this.__sendCallback(this.__msg.VALUE_MUST_BE_STRING_OR_NUMBER+" :: Hash : "+a+" :: Field : "+b,null,d);var e=this._key[a]&&this._key[a].getField(b)?0:1;return this.__addKeyIfNotExist(AyodisEntryField,a),this._key[a].setField(b,c),this.__sendCallback(null,e,d)},Ayodis.hsetnx=function(a,b,c,d){if(!this.__checkValue(c))return this.__sendCallback(this.__msg.VALUE_MUST_BE_STRING_OR_NUMBER+" :: Key : "+a+" :: Field : "+b,null,d);var e=this._key[a]&&this._key[a].getField(b)?0:1;return this.__addKeyIfNotExist(AyodisEntryField,a),1===e&&this._key[a].setField(b,c),this.__sendCallback(null,e,d)},Ayodis.hvals=function(a,b){return this._key[a]?this.__sendCallback(null,this._key[a].getAllFieldValue(),b):this.__sendCallback(null,[],b)},Ayodis.sadd=function(a){for(var b=arguments,c=this.__checkCallback(b[b.length-1]),d=0,e=_.isNull(c)?b.length:b.length-1,f=1;e>f;f++)if(!this.__checkValue(b[f]))return this.__sendCallback(this.__msg.VALUE_MUST_BE_STRING_OR_NUMBER+" SADD :: "+a,null,c);this.__addKeyIfNotExist(AyodisEntryMember,a);for(var f=1;e>f;f++)d+=this._key[a].addIfValueNotExist(b[f])?1:0;return this.__sendCallback(null,d,c)},Ayodis.scard=function(a,b){return this.__sendCallback(null,this._key[a]?this._key[a].getAllMembers().length:0,b)},Ayodis.sdiff=function(a){var b=arguments,c=this.__checkCallback(b[b.length-1]),d=_.isNull(c)?b.length:b.length-1;if(_.isUndefined(this._key[a]))return this.__sendCallback(this.__msg.EMPTY_SET_OR_LIST+" :: SDIFF :: "+a,null,c);for(var e=[],f=1;d>f;f++)for(var g=this._key[b[f]]&&this._key[b[f]]instanceof AyodisEntryMember?this._key[b[f]].getAllMembers():[],h=0,i=g.length;i>h;h++)e.push(g[h]);return this.__sendCallback(null,_.difference(this._key[a]&&this._key[a]instanceof AyodisEntryMember?this._key[a].getAllMembers():[],_.uniq(e)),c)},Ayodis.sdiffstore=function(a,b){for(var c=arguments,d=this.__checkCallback(c[c.length-1]),e=_.isNull(d)?c.length:c.length-1,f=[],g=2;e>g;g++)for(var h=this._key[c[g]]&&this._key[c[g]]instanceof AyodisEntryMember?this._key[c[g]].getAllMembers():[],i=0,j=h.length;j>i;i++)f.push(h[i]);var k=_.difference(this._key[b]&&this._key[b]instanceof AyodisEntryMember?this._key[b].getAllMembers():[],_.uniq(f)),l=0;if(k.length>0){this.__addKeyIfNotExist(AyodisEntryMember,a);for(var g=0,m=k.length;m>g;g++)this._key[a].addIfValueNotExist(k[g]),l++}return this.__sendCallback(null,l,d)},Ayodis.smembers=function(a,b){return this.__sendCallback(null,this._key[a]?this._key[a].getAllMembers():[],b)},Ayodis.srem=function(a){for(var b=arguments,c=this.__checkCallback(b[b.length-1]),d=0,e=_.isNull(c)?b.length:b.length-1,f=1;e>f;f++)if(!this.__checkValue(b[f]))return this.__sendCallback(this.__msg.VALUE_MUST_BE_STRING_OR_NUMBER+" SREM :: "+a,null,c);for(var f=1;e>f;f++)d+=this._key[a]instanceof AyodisEntryMember&&this._key[a].removeValue(b[f])?1:0;return this.__sendCallback(null,d,c)},Ayodis.__overLoadCheckArgs=function(){var a=[{method:"hexists",limit:2,old:Ayodis.hexists},{method:"hget",limit:2,old:Ayodis.hget},{method:"hincrby",limit:3,old:Ayodis.hincrby},{method:"hincrbyfloat",limit:3,old:Ayodis.hincrbyfloat},{method:"hlen",limit:1,old:Ayodis.hlen},{method:"hmget",limit:1,old:Ayodis.hmget},{method:"hmset",limit:1,old:Ayodis.hmset},{method:"hset",limit:3,old:Ayodis.hset},{method:"hsetnx",limit:3,old:Ayodis.hsetnx},{method:"hvals",limit:1,old:Ayodis.hvals},{method:"sadd",limit:2,old:Ayodis.sadd},{method:"scard",limit:1,old:Ayodis.scard},{method:"sdiff",limit:2,old:Ayodis.sdiff},{method:"sdiffstore",limit:3,old:Ayodis.sdiffstore},{method:"smembers",limit:1,old:Ayodis.smembers},{method:"srem",limit:2,old:Ayodis.srem}];return _.each(a,function(a){Ayodis[a.method]=function(){var b=0+a.limit;_.isFunction(arguments[arguments.length-1])&&b++;for(var c=0;b>c;c++)if(!this.__checkArgs(arguments[c]))return this.__sendCallback(this.__msg.ERR_ARGS+" "+a.method.toUpperCase(),null,arguments[arguments.length-1]);return a.old.apply(this,arguments)}}),this},Ayodis.__overLoadCheckHashField=function(){var a=[{method:"hexists",old:Ayodis.hexists},{method:"hget",old:Ayodis.hget},{method:"hincrby",old:Ayodis.hincrby},{method:"hincrbyfloat",old:Ayodis.hincrbyfloat},{method:"hset",old:Ayodis.hset},{method:"hsetnx",old:Ayodis.hsetnx}];return _.each(a,function(a){Ayodis[a.method]=function(){return this.__checkField(arguments[1])?a.old.apply(this,arguments):this.__sendCallback(this.__msg.FIELD_MUST_BE_STRING+" :: "+arguments[1],null,arguments[2])}}),this},Ayodis.__overLoadCheckKey=function(){var a=[{keyType:Ayodis.__CONST.KEY.HASH,keyData:[{method:"hexists",old:Ayodis.hexists},{method:"hget",old:Ayodis.hget},{method:"hincrby",old:Ayodis.hincrby},{method:"hincrbyfloat",old:Ayodis.hincrbyfloat},{method:"hlen",old:Ayodis.hlen},{method:"hmget",old:Ayodis.hmget},{method:"hmset",old:Ayodis.hmset},{method:"hset",old:Ayodis.hset},{method:"hsetnx",old:Ayodis.hsetnx},{method:"hvals",old:Ayodis.hvals}]},{keyType:Ayodis.__CONST.KEY.SET,keyData:[{method:"sadd",old:Ayodis.sadd},{method:"scard",old:Ayodis.scard},{method:"sdiff",old:Ayodis.sdiff,option:{type:"allKeys"}},{method:"sdiffstore",old:Ayodis.sdiffstore,option:{type:"allKeys"}},{method:"smembers",old:Ayodis.smembers},{method:"srem",old:Ayodis.srem}]}];return _.each(a,function(a){_.each(a.keyData,function(b){Ayodis[b.method]=function(){if(b.option&&"allKeys"===b.option.type)for(var c=_.isFunction(arguments[arguments.length-1])?arguments.length-1:arguments.length,d=0;c>d;d++){if(!this.__checkHash(arguments[d]))return this.__sendCallback(this.__msg.KEY_MUST_BE_STRING+" "+b.method.toUpperCase(),null,arguments[arguments.length-1]);if("OK"!==this.__checkKey(arguments[d],a.keyType))return this.__sendCallback(this.__checkKey(arguments[d],a.keyType)+" in method "+b.method.toUpperCase(),null,arguments[arguments.length-1])}else{if(!this.__checkHash(arguments[0]))return this.__sendCallback(this.__msg.KEY_MUST_BE_STRING+" "+b.method.toUpperCase(),null,arguments[arguments.length-1]);var e=this.__checkKey(arguments[0],a.keyType);if("OK"!==e)return this.__sendCallback(e+" in method "+b.method.toUpperCase(),null,arguments[arguments.length-1])}return b.old.apply(this,arguments)}})}),this},Ayodis.__overLoadCheckHashField().__overLoadCheckKey().__overLoadCheckArgs();